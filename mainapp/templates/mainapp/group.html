{% extends 'mainapp/base.html' %}

{% block title %}Group {{ group.id }} - NAFakes{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-12">
    <h1 class="text-4xl font-bold mb-8 text-center text-primary">Group {{ group.id }}</h1>
    <div class="bg-white shadow-lg rounded-lg p-6 mb-8">
        <h2 class="text-2xl font-semibold mb-4">Group Information</h2>
        <p class="mb-2"><strong>Group ID:</strong> {{ group.id }}</p>
        <p class="mb-2"><strong>Members:</strong> {{ group.members.count }}</p>
        <p class="mb-2"><strong>Creator:</strong> {{ creator.name }}</p>
    </div>
    <div class="bg-white shadow-lg rounded-lg p-6 mb-8">
        <h2 class="text-2xl font-semibold mb-4">Members</h2>
        <ul class="space-y-2">
            {% for member in group.members.all %}
            <li class="flex justify-between items-center">
                <span>{{ member.name }}</span>
                <div class="space-x-2">
                    {% if member.member_id == group.creator_member_id %}
                        <span class="bg-green-500 text-white px-3 py-1 rounded-full">Creator</span>
                    {% else %}
                        {% if request.session.member_id == group.creator_member_id %}
                            <button class="change-name-btn bg-blue-500 text-white px-3 py-1 rounded-full hover:bg-blue-600 transition duration-300" data-member-id="{{ member.id }}">Change Name</button>
                            <form action="{% url 'kick_member' group.id member.id %}" method="post" class="inline">
                                {% csrf_token %}
                                <input type="hidden" name="member_id" value="{{ request.session.member_id }}">
                                <button type="submit" class="bg-red-500 text-white px-3 py-1 rounded-full hover:bg-red-600 transition duration-300">Kick</button>
                            </form>
                        {% endif %}
                    {% endif %}
                    {% if member.member_id == request.session.member_id %}
                        <form action="{% url 'leave_group' group.id member.id %}" method="post" class="inline">
                            {% csrf_token %}
                            <button type="submit" class="bg-yellow-500 text-white px-3 py-1 rounded-full hover:bg-yellow-600 transition duration-300">Leave</button>
                        </form>
                    {% endif %}
                </div>
            </li>
            {% endfor %}
        </ul>
    </div>
</div>

<script>
    document.querySelectorAll('.change-name-btn').forEach(button => {
        button.addEventListener('click', function() {
            const memberId = this.dataset.memberId;
            const newName = prompt('Enter new name:');
            if (newName) {
                fetch(`{% url 'change_name' group.id 0 %}`.replace('0', memberId), {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/x-www-form-urlencoded',
                        'X-CSRFToken': '{{ csrf_token }}'
                    },
                    body: `new_name=${encodeURIComponent(newName)}&member_id={{ request.session.member_id }}`
                }).then(() => location.reload());
            }
        });
    });
</script>
{% endblock %}